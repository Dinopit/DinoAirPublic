#!/usr/bin/env sh

echo "ğŸ” Running basic pre-commit checks..."

# Check for SKIP_HOOKS environment variable
if [ "$SKIP_HOOKS" = "1" ] || [ "$SKIP_HOOKS" = "true" ]; then
    echo "âš ï¸  SKIP_HOOKS is set. Bypassing all pre-commit checks..."
    echo "âš ï¸  Remember to run linting manually later!"
    exit 0
fi

# Check for merge conflicts
echo "ğŸ” Checking for merge conflicts..."
if git diff --cached --name-only | xargs grep -l '<<<<<<<\|=======' 2>/dev/null | grep -q .; then
    echo "âŒ Merge conflict markers detected! Please resolve before committing."
    exit 1
fi

# Check for .env files
echo "ğŸ” Checking for .env files..."
if git diff --cached --name-only | grep -E '\.env$' | grep -v '\.env\.example$'; then
    echo "âŒ .env files must not be committed!"
    exit 1
fi

# Check for hardcoded credentials (basic)
echo "ğŸ” Checking for obvious credentials..."
if git diff --cached --name-only | xargs grep -E "(password|secret|key|token)\\s*=\\s*[\"\'][^\"\']+" 2>/dev/null | grep -v -E "(example|test|spec|mock|fake|dummy|placeholder)"; then
    echo "âŒ Potential hardcoded credentials detected!"
    echo "ğŸ’¡ If this is intentional, use SKIP_HOOKS=1"
    exit 1
fi

echo "âœ… Basic pre-commit checks completed!"
echo "ğŸ’¡ Use SKIP_HOOKS=1 to bypass all checks if needed"
